!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var t;t="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,t.AssetPickerAdapterSymcodecloud=e()}}(function(){return function e(t,i,s){function a(o,r){if(!i[o]){if(!t[o]){var l="function"==typeof require&&require;if(!r&&l)return l(o,!0);if(n)return n(o,!0);var c=new Error("Cannot find module '"+o+"'");throw c.code="MODULE_NOT_FOUND",c}var h=i[o]={exports:{}};t[o][0].call(h.exports,function(e){var i=t[o][1][e];return a(i?i:e)},h,h.exports,e,t,i,s)}return i[o].exports}for(var n="function"==typeof require&&require,o=0;o<s.length;o++)a(s[o]);return a}({1:[function(e,t,i){t.exports={translations:{description:{en:"Symcode cloud adapter",de:"Symcode Cloud Adapter"}},template:e("./template.html"),apikey:"",http:function(){var e={base:this.config.url.replace(/\/+$/,"")+"/api"};return e},data:function(){return{category:null,search:null,items:null,results:{},extensions:null}},watch:{"appConfig.pick":{handler:function(e){var t=this.assembleTerms();this.extensions=e.extensions;var i=this.assembleTerms();if(t.hash!==i.hash&&this.results[t.hash]){for(var s=this.results[t.hash].items;s.length>0;)s.pop();this.loadAssets(s)}},immediate:!0}},dateFormat:"YYYY-MM-DDTHH:mm:ss",methods:{assembleTerms:function(){var e=[],t=function(t,i,s){e.push({field:t,operator:i,value:s})};return this.category&&t("category","exact",this.category.id),this.search&&t("description","freeform",this.search),this.extensions&&this.extensions.length&&t("fileformat","matches",this.extensions.join("|")),e.length||t("id","matches","*"),e},loadAssets:function(e){var t=this.assembleTerms(),i=JSON.stringify(t),s=this.results[i];if(s){if(e&&s.items!==e&&(Array.prototype.push.apply(e,s.items),e.total=s.items.total,e.loading=s.items.loading,e.query=i,s.items=e),s.page===s.pages)return this.$promise(function(e){e(s)})}else s={page:0,pages:0,items:e||[]},s.items.total=s.items.total||s.items.length,this.results[i]=s;s.items.loading=!0,s.items.query=i;var a="",n="";t.forEach(function(e){"category"==e.field&&(a=e.value),"description"==e.field&&(n=e.value)}),this.http.get("/entries?page="+(s.page+1)+"&limit=20&filter[categories]="+a+"&filter[fulltext]="+n,{headers:{apikey:this.apikey}}).then(function(e){return s.items.query===i&&(s.page=parseInt(e.data.current_page),s.pages=parseInt(e.data.page_count),s.items.total=parseInt(e.data.total),s.items.loading=!1,e.data.data.forEach(function(e){var t=e.type.match("image/")?e.hasOwnProperty("extension")?e.extension:(e.original_name.match(/\.([0-9a-z]+)$/i)||[]).pop():void 0,a=this.createItem({id:e.hash,query:i,type:"file",name:e.name,title:e.name,extension:t,created:this.parseDate(e.created_at),modified:this.parseDate(e.changed_at),thumbnail:e.media_thumb_url.replace(".png",".jpeg")+"?width=150px",links:{open:e.media_thumb_url+"?width=800px",download:e.media_file_url},data:e});s.items.push(a)}.bind(this))),s}.bind(this))},setupLogin:function(e){var t=this,i=function(i,s,a){t.http.get("/login?username="+i+"&password="+s).then(function(i){200===i.status?(i.data=i.json(),i.data.apikey?(t.apikey=i.data.apikey,a(!0),e(i.data.apikey)):(t.config.cliUsername=null,t.config.cliPassword=null,a(!1))):(t.config.cliUsername=null,t.config.cliPassword=null,a(!1))})};this.config.cliUsername&&this.config.cliPassword?i(this.config.cliUsername,this.config.cliPassword,function(){}):this.login(function(e,t,s){i(this.config.cliUsername,this.config.cliPassword,s)}).bind(this)},loadCategories:function(e){var t=0;e.item&&e.item.id&&(t=e.item.id),this.http.get("/categories?limit=100&parent_id="+t,{headers:{apikey:this.apikey}}).then(function(t){e.items=t.data.data.map(function(e){return this.createItem({id:e.id,name:e.name,type:"category",data:e})}.bind(this))})}},events:{"select-item":function(e){if("entrypoint"!==e)return!0;this.category=null,this.search=null;var t=this;t.apikey?t.loadAssets().then(function(e){t.items=e.items,t.$parent.$dispatch("select-item",this)}):t.setupLogin(function(){t.loadAssets().then(function(e){t.items=e.items,t.$parent.$dispatch("select-item",this)})})},"load-more-items":function(e){var t=this;t.apikey?t.loadAssets(e):t.setupLogin(function(){t.loadAssets(e)})},search:function(e,t){var i=this;return i.apikey?(i.search=e,i.loadAssets(t)):i.setupLogin(function(){i.search=e,i.loadAssets(t)}),!0},"category-load-items":function(e){var t=this;t.apikey?t.loadCategories(e):t.setupLogin(function(){t.loadCategories(e)})},"category-select-item":function(e){this.category=e.item,this.search=null;var t=this;t.apikey?(t.loadAssets(e.items),t.$dispatch("select-item",e)):t.setupLogin(function(){t.loadAssets(e.items),t.$dispatch("select-item",e)})}}}},{"./template.html":2}],2:[function(e,t,i){t.exports='<div>\n    <tree :fetch="fetch" name="category" :types="[\'category\']"></tree>\n</div>'},{}]},{},[1])(1)});
//# sourceMappingURL=../maps/adapter/symcodecloud.js.map
